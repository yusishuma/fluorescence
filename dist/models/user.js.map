{"version":3,"sources":["../../models/user.js"],"names":[],"mappings":";;;;;AAGA,IAAI,QAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AACnC,IAAI,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC/B,IAAI,SAAS,GAAG,OAAO,CAAC,oBAAoB,CAAC,CAAC;AAC9C,IAAM,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC;AAC/B,IAAI,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;;AAE/B,IAAM,UAAU,GAAG,IAAI,MAAM,CAAC;;;;;AAK1B,YAAQ,EAAE;AACN,YAAI,EAAE,MAAM;AACZ,YAAI,EAAE,IAAI;AACV,mBAAS,KAAK;KACjB;;;;;;AAMD,UAAM,EAAE;AACJ,YAAI,EAAE,MAAM;AACZ,mBAAS,SAAS,CAAC,MAAM,CAAC,OAAO;AACjC,gBAAM,CACF,CAAC,EACD,CAAC,EACD,CAAC,CACJ;;KAEJ;;;;;AAKD,UAAM,EAAE;AACJ,YAAI,EAAE,MAAM;KACf;;;;;AAKD,YAAQ,EAAE;AACN,YAAI,EAAE,MAAM;AACZ,YAAI,EAAE,IAAI;KACb;AACD,SAAK,EAAE;AACH,YAAI,EAAE,MAAM;AACZ,YAAI,EAAE,IAAI;AACV,aAAK,EAAE,IAAI;KACd;AACD,YAAQ,EAAE;AACN,YAAI,EAAE,MAAM;AACZ,YAAI,EAAE,IAAI;AACV,WAAG,EAAE,aAAU,QAAQ,EAAE;AACrB,gBAAI,CAAC,IAAI,GAAG,MAAM,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;AACtD,gBAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAC;SAClD;KACJ;AACD,aAAS,EAAE;AACP,YAAI,EAAE,IAAI;AACV,gBAAQ,EAAE,IAAI;AACd,mBAAS,IAAI,CAAC,GAAG;AACjB,WAAG,EAAE,aAAU,IAAI,EAAE;AACjB,mBAAO,MAAM,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,qBAAqB,CAAC,CAAC;SACrD;KACJ;AACD,aAAS,EAAE;AACP,YAAI,EAAE,IAAI;AACV,gBAAQ,EAAE,IAAI;AACd,mBAAS,IAAI,CAAC,GAAG;AACjB,WAAG,EAAE,aAAU,IAAI,EAAE;AACjB,mBAAO,MAAM,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,qBAAqB,CAAC,CAAC;SACrD;KACJ;CACA,EACD;AACA,MAAE,EAAE,KAAK;AACT,UAAM,EAAE;AACJ,eAAO,EAAE,IAAI;KAChB;CACJ,CAAC,CAAC;AACH,UAAU,CAAC,OAAO,CAAC,eAAe,GAAG,UAAU,QAAQ,EAAE;AACrD,WAAO,MAAM,CAAC,UAAU,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;CAC9E,CAAC;;;AAGF,UAAU,CAAC,OAAO,CAAC,aAAa,GAAG,UAAU,QAAQ,EAAE;AACnD,WAAO,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,KAAK,IAAI,CAAC,QAAQ,CAAC;CAC3D,CAAC;;AAEF,UAAU,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,GAAG,UAAU,GAAG,EAAE,GAAG,EAAE;AACtD,OAAG,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;AAChC,WAAO,GAAG,CAAC,GAAG,CAAC;AACf,WAAO,GAAG,CAAC,GAAG,CAAC;CAClB,CAAC;AACF,MAAM,CAAC,OAAO,GAAG,UAAU,CAAC","file":"user.js","sourcesContent":["/**\n * Created by matonghe on 15/03/2017.\n */\nvar mongoose = require(\"mongoose\");\nvar moment = require(\"moment\");\nvar CONSTANTS = require(\"../utils/constants\");\nconst Schema = mongoose.Schema;\nvar crypto = require('crypto');\n\nconst UserSchema = new Schema({\n\n    /**\n     * 昵称\n     */\n    nickname: {\n        type: String,\n        trim: true,\n        default: \"荧光粉\"\n    },\n\n    /**\n     * 性别\n     * {UNKNOWN: 0, MALE: 1, FEMALE: 2}\n     */\n    gender: {\n        type: Number,\n        default: CONSTANTS.GENDER.UNKNOWN,\n        enum: [\n            0,\n            1,\n            2\n        ]\n\n    },\n\n    /**\n     * 头像\n     */\n    avatar: {\n        type: String\n    },\n\n    /**\n     * 用户账号信息\n     */\n    username: {\n        type: String,\n        trim: true\n    },\n    phone: {\n        type: String,\n        trim: true,\n        index: true\n    },\n    password: {\n        type: String,\n        trim: true,\n        set: function (password) {\n            this.salt = crypto.randomBytes(32).toString('base64');\n            this.password = this.encryptPassword(password);\n        }\n    },\n    createdAt: {\n        type: Date,\n        required: true,\n        default: Date.now,\n        get: function (date) {\n            return moment(date).format('YYYY-MM-DD HH:mm:ss');\n        }\n    },\n    updatedAt: {\n        type: Date,\n        required: true,\n        default: Date.now,\n        get: function (date) {\n            return moment(date).format('YYYY-MM-DD HH:mm:ss');\n        }\n    }\n    },\n    {\n    id: false,\n    toJSON: {\n        getters: true\n    }\n});\nUserSchema.methods.encryptPassword = function (password) {\n    return crypto.createHmac('sha1', this.salt).update(password).digest('hex');\n};\n\n//验证密码\nUserSchema.methods.validPassword = function (password) {\n    return this.encryptPassword(password) === this.password;\n};\n\nUserSchema.options.toJSON.transform = function (doc, ret) {\n    ret.userId = ret._id.toString();\n    delete ret.__v;\n    delete ret._id;\n};\nmodule.exports = UserSchema;"]}